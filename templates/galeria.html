<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galer√≠a - Trajineras Barr√≥n</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/galeria.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
</head>

<body>
    {% include 'header.html' %}

    <!-- 1. HERO SECTION CON VIDEO -->
    <section class="hero-gallery">
        <div class="video-background">
            <div class="video-overlay"></div>
            <video autoplay muted loop playsinline>
                <source
                    src="https://assets.mixkit.co/videos/preview/mixkit-aerial-view-of-a-canal-in-xochimilco-49558-large.mp4"
                    type="video/mp4">
                <!-- Video de respaldo -->
                Tu navegador no soporta videos HTML5.
            </video>
        </div>

        <div class="hero-content">
            <div class="container">
                <h1 class="hero-title">
                    <i class="fas fa-camera-retro"></i> Xochimilco en Im√°genes
                </h1>
                <p class="hero-subtitle">Donde Cada Recuerdo se Convierte en Arte</p>
                <p class="hero-description">
                    Explora momentos reales capturados por nuestros visitantes y d√©jate inspirar por la magia de
                    Xochimilco.
                </p>

                <div class="hero-stats">
                    <div class="stat-item">
                        <i class="fas fa-images"></i>
                        <span class="stat-number">500+</span>
                        <span class="stat-label">Fotos</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-video"></i>
                        <span class="stat-number">50+</span>
                        <span class="stat-label">Videos</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-heart"></i>
                        <span class="stat-number">2.5K</span>
                        <span class="stat-label">Likes</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-users"></i>
                        <span class="stat-number">300+</span>
                        <span class="stat-label">Visitantes</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="scroll-indicator">
            <i class="fas fa-chevron-down"></i>
        </div>
    </section>

    <!-- 2. GALER√çA PRINCIPAL INTERACTIVA -->
    <section class="section gallery-main" id="galeria">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-th-large"></i> Galer√≠a Interactiva
                </h2>
                <p class="section-subtitle">
                    Filtra por categor√≠a y descubre momentos √∫nicos
                </p>
            </div>

            <!-- Filtros de categor√≠a -->
            <div class="gallery-filters">
                <div class="filters-container">
                    <button class="filter-btn active" data-filter="all">
                        <i class="fas fa-border-all"></i> Todas
                    </button>
                    <!-- Los filtros se cargar√°n din√°micamente -->
                </div>

                <div class="filter-info">
                    <span id="filter-count">Cargando...</span>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="grid">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button class="view-btn" data-view="masonry">
                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Grid de im√°genes -->
            <div class="gallery-grid" id="gallery-grid">
                <!-- Las im√°genes se cargar√°n din√°micamente -->
                <div class="loading-gallery">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando galer√≠a...</p>
                </div>
            </div>

            <!-- Modal para imagen ampliada -->
            <div class="image-modal" id="image-modal">
                <div class="modal-content">
                    <button class="modal-close" onclick="closeModal()">
                        <i class="fas fa-times"></i>
                    </button>

                    <div class="modal-image-container">
                        <img id="modal-image" src="" alt="">
                        <div class="image-loader">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </div>

                    <div class="modal-info">
                        <div class="image-meta">
                            <div class="author-info">
                                <div class="author-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <h4 id="modal-author">Cargando...</h4>
                                    <p id="modal-date">Fecha</p>
                                </div>
                            </div>

                            <div class="image-stats">
                                <button class="stat-btn like-btn" onclick="likeImage()">
                                    <i class="far fa-heart"></i>
                                    <span id="modal-likes">0</span>
                                </button>
                                <button class="stat-btn share-btn" onclick="shareImage()">
                                    <i class="fas fa-share-alt"></i>
                                    <span>Compartir</span>
                                </button>
                                <button class="stat-btn download-btn" onclick="downloadImage()">
                                    <i class="fas fa-download"></i>
                                    <span>Descargar</span>
                                </button>
                            </div>
                        </div>

                        <div class="image-description">
                            <h4>Descripci√≥n</h4>
                            <p id="modal-description">Cargando descripci√≥n...</p>
                        </div>

                        <div class="image-tags">
                            <h4>Etiquetas</h4>
                            <div class="tags-container" id="modal-tags">
                                <!-- Tags se cargar√°n din√°micamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bot√≥n para cargar m√°s -->
            <div class="load-more-container">
                <button class="btn btn-outline" id="load-more-btn" onclick="loadMoreImages()">
                    <i class="fas fa-plus"></i> Cargar M√°s Fotos
                </button>
            </div>
        </div>
    </section>

    <!-- 3. GALER√çA DE VIDEOS CORTOS -->
    <section class="section video-gallery" style="background-color: var(--light-color);">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-play-circle"></i> Videos de Experiencias Reales
                </h2>
                <p class="section-subtitle">
                    Descubre Xochimilco a trav√©s de los ojos de nuestros visitantes
                </p>
            </div>

            <div class="videos-grid" id="videos-grid">
                <!-- Los videos se cargar√°n din√°micamente -->
                <div class="loading-videos">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando videos...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. EXPERIENCIAS DESTACADAS -->
    <section class="section featured-experiences">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-star"></i> Experiencias Destacadas
                </h2>
                <p class="section-subtitle">
                    Descubre los rincones m√°s m√°gicos de Xochimilco
                </p>
            </div>

            <!-- Carrusel de experiencias -->
            <div class="swiper experiences-swiper">
                <div class="swiper-wrapper" id="experiences-carousel">
                    <!-- Las experiencias se cargar√°n din√°micamente -->
                </div>

                <!-- Navegaci√≥n del carrusel -->
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination"></div>
            </div>

            <!-- Descripci√≥n expandida -->
            <div class="experience-details" id="experience-details">
                <!-- Se llenar√° din√°micamente cuando se seleccione una experiencia -->
            </div>
        </div>
    </section>

    <!-- 5. GALER√çA HIST√ìRICA -->
    <section class="section historical-gallery">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-history"></i> Galer√≠a Hist√≥rica
                </h2>
                <p class="section-subtitle">
                    Un viaje en el tiempo a trav√©s de Xochimilco
                </p>
            </div>

            <div class="timeline-container">
                <div class="timeline-line"></div>

                <div class="timeline-items" id="timeline-items">
                    <!-- Los items hist√≥ricos se cargar√°n din√°micamente -->
                </div>
            </div>

            <div class="before-after-container" id="before-after-gallery">
                <!-- Comparaciones antes/despu√©s se cargar√°n din√°micamente -->
            </div>
        </div>
    </section>

    <!-- 7. LLAMADO A LA ACCI√ìN VISUAL -->
    <section class="section gallery-cta" id="subir-foto">
        <div class="container">
            <div class="cta-container">
                <div class="cta-content">
                    <h2 class="cta-title">
                        <i class="fas fa-camera"></i> ¬øListo para aparecer en nuestra galer√≠a?
                    </h2>
                    <p class="cta-subtitle">
                        Comparte tus momentos y s√© parte de nuestra comunidad
                    </p>

                    <div class="cta-features">
                        <div class="feature-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Fotos seleccionadas aparecen en nuestra p√°gina principal</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Posibilidad de ganar descuentos para tu pr√≥xima visita</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Reconocimiento como fot√≥grafo destacado</span>
                        </div>
                    </div>

                    <div class="hashtag-container">
                        <h4>Usa nuestro hashtag oficial:</h4>
                        <div class="hashtag-tag">
                            <i class="fas fa-hashtag"></i>
                            <span>TrajinerasBarron</span>
                            <button class="copy-hashtag" onclick="copyHashtag()">
                                <i class="far fa-copy"></i> Copiar
                            </button>
                        </div>
                        <p class="hashtag-note">
                            Etiqueta @trajinerasbarron en Instagram para aparecer aqu√≠
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER ESPECIAL PARA GALER√çA -->
    <footer class="gallery-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-camera"></i> Galer√≠a Trajineras Barr√≥n</h3>
                    <p>Un archivo visual de experiencias inolvidables en Xochimilco desde 2024</p>

                    <div class="social-gallery">
                        <h4>S√≠guenos para m√°s fotos:</h4>
                        <div class="social-links">
                            <a href="#" class="social-link instagram">
                                <i class="fab fa-instagram"></i> @trajinerasbarron
                            </a>
                            <a href="#" class="social-link facebook">
                                <i class="fab fa-facebook"></i> /trajinerasbarron
                            </a>
                            <a href="#" class="social-link tiktok">
                                <i class="fab fa-tiktok"></i> @trajinerasbarron
                            </a>
                        </div>
                    </div>
                </div>

                <div class="footer-section">
                    <h3><i class="fas fa-file-contract"></i> Uso de Im√°genes</h3>
                    <ul class="legal-links">
                        <li><a href="/politica-imagenes">Pol√≠tica de Uso de Im√°genes</a></li>
                        <li><a href="/derechos-autor">Derechos de Autor</a></li>
                        <li><a href="/privacidad">Privacidad de Fotograf√≠as</a></li>
                        <li><a href="/terminos">T√©rminos de Publicaci√≥n</a></li>
                    </ul>

                    <div class="copyright">
                        <p>&copy; 2024 Trajineras Barr√≥n. Todas las fotos son propiedad de sus respectivos autores.</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    {% include 'footer.html' %}

    <!-- Botones flotantes -->
    <div class="floating-buttons">
        <a href="https://wa.me/525560094568" class="floating-btn whatsapp-btn" target="_blank">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="tel:+525560094568" class="floating-btn phone-btn">
            <i class="fas fa-phone-alt"></i>
        </a>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // Variables globales
        let currentFilter = 'all';
        let currentView = 'grid';
        let currentPage = 1;
        let isLoading = false;
        let selectedImage = null;
        let uploadedPhoto = null;

        // Datos de ejemplo para la galer√≠a
        const galleryImages = [
            // Eventos
            {
                id: 1, category: 'eventos', url: 'https://images.unsplash.com/photo-1519225421980-715cb0215aed',
                author: 'Juan P√©rez', likes: 45, date: '2024-03-15', description: 'Celebraci√≥n de XV a√±os en trajinera',
                tags: ['#XVa√±os', '#fiesta', '#trajineras']
            },
            {
                id: 2, category: 'eventos', url: 'https://images.unsplash.com/photo-1542601906990-b4d3fb778b09',
                author: 'Mar√≠a Garc√≠a', likes: 32, date: '2024-02-28', description: 'Boda en los canales de Xochimilco',
                tags: ['#boda', '#romantico', '#xochimilco']
            },

            // Familiar
            {
                id: 3, category: 'familiar', url: 'https://images.unsplash.com/photo-1566073771259-6a8506099945',
                author: 'Familia Rodr√≠guez', likes: 89, date: '2024-03-10', description: 'D√≠a familiar en Xochimilco',
                tags: ['#familia', '#disfrute', '#paseo']
            },
            {
                id: 4, category: 'familiar', url: 'https://images.unsplash.com/photo-1528433556524-74e7e3bfa599',
                author: 'Ana Mart√≠nez', likes: 56, date: '2024-03-05', description: 'Los ni√±os disfrutando del recorrido',
                tags: ['#ni√±os', '#alegria', '#recorrido']
            },

            // Rom√°ntico
            {
                id: 5, category: 'romantico', url: 'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3',
                author: 'Carlos y Sof√≠a', likes: 67, date: '2024-02-14', description: 'Cena rom√°ntica al atardecer',
                tags: ['#romantico', '#atardecer', '#cena']
            },

            // Amanecer/Atardecer
            {
                id: 6, category: 'amanecer', url: 'https://images.unsplash.com/photo-1501854140801-50d01698950b',
                author: 'Fot√≥grafo An√≥nimo', likes: 78, date: '2024-03-01', description: 'Amanecer en los canales',
                tags: ['#amanecer', '#naturaleza', '#paisaje']
            },

            // Gastronom√≠a
            {
                id: 7, category: 'gastronomia', url: 'https://images.unsplash.com/photo-1565958011703-44f9829ba187',
                author: 'Chef Miguel', likes: 42, date: '2024-03-12', description: 'Comida tradicional mexicana',
                tags: ['#comida', '#mexicana', '#tradicion']
            },

            // M√∫sica
            {
                id: 8, category: 'musica', url: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d',
                author: 'Grupo Musical', likes: 53, date: '2024-03-08', description: 'Mariachi en trajinera',
                tags: ['#musica', '#mariachi', '#fiesta']
            },

            // Naturaleza
            {
                id: 9, category: 'naturaleza', url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4',
                author: 'Ecologista', likes: 91, date: '2024-03-03', description: 'Flora y fauna de Xochimilco',
                tags: ['#naturaleza', '#ecologia', '#chinampas']
            }
        ];

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function () {
            // Cargar datos de la galer√≠a
            loadGalleryData();

            // Inicializar carrusel de experiencias
            initExperiencesCarousel();

            // Inicializar eventos
            initEventListeners();

            // Cargar im√°genes iniciales
            loadImages();
        });

        // Cargar datos de la galer√≠a desde el servidor
        async function loadGalleryData() {
            try {
                const response = await fetch('/api/galeria/datos');
                const data = await response.json();

                // Cargar categor√≠as
                loadCategories(data.categorias);

                // Cargar videos
                loadVideos(data.videos);

                // Cargar experiencias
                loadExperiences(data.experiencias);

                // Cargar √°lbumes
                loadAlbums(data.albumes);

                // Cargar hist√≥rico
                loadHistorical(data.historico);

            } catch (error) {
                console.error('Error cargando datos:', error);
                // Usar datos por defecto
                loadDefaultData();
            }
        }

        // Cargar datos por defecto
        function loadDefaultData() {
            const defaultCategories = [
                { id: "eventos", nombre: "üéâ Eventos", icono: "fas fa-calendar-star", contador: 45 },
                { id: "familiar", nombre: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familiar", icono: "fas fa-users", contador: 78 },
                { id: "romantico", nombre: "üíë Rom√°ntico", icono: "fas fa-heart", contador: 52 },
                { id: "amanecer", nombre: "üåÖ Amanecer/Atardecer", icono: "fas fa-sun", contador: 34 },
                { id: "gastronomia", nombre: "üçΩÔ∏è Gastronom√≠a", icono: "fas fa-utensils", contador: 29 },
                { id: "musica", nombre: "üéµ M√∫sica y Fiesta", icono: "fas fa-music", contador: 41 },
                { id: "naturaleza", nombre: "üåø Naturaleza", icono: "fas fa-leaf", contador: 63 }
            ];

            loadCategories(defaultCategories);
        }

        // Cargar categor√≠as en los filtros
        function loadCategories(categorias) {
            const filtersContainer = document.querySelector('.filters-container');

            // Crear bot√≥n "Todas"
            const allButton = document.querySelector('.filter-btn[data-filter="all"]');
            const totalImages = galleryImages.length;
            allButton.innerHTML = `<i class="fas fa-border-all"></i> Todas (${totalImages})`;

            // Crear botones para cada categor√≠a
            categorias.forEach(categoria => {
                const count = galleryImages.filter(img => img.category === categoria.id).length;
                if (count > 0) {
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.dataset.filter = categoria.id;
                    button.innerHTML = `
                        <i class="${categoria.icono}"></i> ${categoria.nombre} (${count})
                    `;

                    button.addEventListener('click', function () {
                        setFilter(categoria.id);
                    });

                    filtersContainer.appendChild(button);
                }
            });

            // Actualizar contador inicial
            updateFilterCount();
        }

        // Establecer filtro
        function setFilter(filterId) {
            currentFilter = filterId;
            currentPage = 1;

            // Actualizar botones activos
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filterId) {
                    btn.classList.add('active');
                }
            });

            // Recargar im√°genes
            loadImages();
            updateFilterCount();

            // Scroll suave a la galer√≠a
            document.getElementById('galeria').scrollIntoView({ behavior: 'smooth' });
        }

        // Actualizar contador de filtro
        function updateFilterCount() {
            const countElement = document.getElementById('filter-count');
            const filteredImages = currentFilter === 'all'
                ? galleryImages
                : galleryImages.filter(img => img.category === currentFilter);

            countElement.textContent = `${filteredImages.length} fotos`;
        }

        // Cargar im√°genes
        function loadImages() {
            const grid = document.getElementById('gallery-grid');

            // Mostrar loading
            grid.innerHTML = `
                <div class="loading-gallery">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando fotos...</p>
                </div>
            `;

            // Simular carga
            setTimeout(() => {
                renderImages();
            }, 500);
        }

        // Renderizar im√°genes
        function renderImages() {
            const grid = document.getElementById('gallery-grid');

            // Filtrar im√°genes
            const filteredImages = currentFilter === 'all'
                ? galleryImages
                : galleryImages.filter(img => img.category === currentFilter);

            // Calcular im√°genes a mostrar (paginaci√≥n simple)
            const imagesPerPage = 9;
            const startIndex = (currentPage - 1) * imagesPerPage;
            const endIndex = Math.min(startIndex + imagesPerPage, filteredImages.length);
            const imagesToShow = filteredImages.slice(startIndex, endIndex);

            // Crear HTML
            let html = '';

            imagesToShow.forEach(image => {
                html += `
                    <div class="gallery-item" data-category="${image.category}" data-id="${image.id}">
                        <div class="image-container">
                            <img src="${image.url}?w=400&h=300&fit=crop" 
                                 alt="${image.description}"
                                 loading="lazy">
                            <div class="image-overlay">
                                <div class="overlay-content">
                                    <div class="image-meta">
                                        <div class="image-author">
                                            <i class="fas fa-user"></i>
                                            <span>${image.author}</span>
                                        </div>
                                        <div class="image-likes">
                                            <i class="far fa-heart"></i>
                                            <span>${image.likes}</span>
                                        </div>
                                    </div>
                                    <div class="image-actions">
                                        <button class="action-btn view-btn" onclick="openImageModal(${image.id})">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                        <button class="action-btn like-btn" onclick="toggleLike(${image.id})">
                                            <i class="far fa-heart"></i>
                                        </button>
                                        <button class="action-btn share-btn" onclick="shareImage(${image.id})">
                                            <i class="fas fa-share-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="image-info">
                            <p class="image-desc">${image.description}</p>
                            <div class="image-tags">
                                ${image.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });

            grid.innerHTML = html;

            // Configurar bot√≥n de cargar m√°s
            const loadMoreBtn = document.getElementById('load-more-btn');
            if (endIndex < filteredImages.length) {
                loadMoreBtn.style.display = 'block';
            } else {
                loadMoreBtn.style.display = 'none';
            }
        }

        // Cargar m√°s im√°genes
        function loadMoreImages() {
            currentPage++;
            isLoading = true;

            const loadMoreBtn = document.getElementById('load-more-btn');
            loadMoreBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando...';
            loadMoreBtn.disabled = true;

            setTimeout(() => {
                renderImages();
                isLoading = false;
                loadMoreBtn.innerHTML = '<i class="fas fa-plus"></i> Cargar M√°s Fotos';
                loadMoreBtn.disabled = false;
            }, 1000);
        }

        // Abrir modal de imagen
        function openImageModal(imageId) {
            const image = galleryImages.find(img => img.id === imageId);
            if (!image) return;

            selectedImage = image;

            const modal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            const loader = document.querySelector('.image-loader');

            // Mostrar modal
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';

            // Mostrar loader
            loader.style.display = 'flex';
            modalImage.style.display = 'none';

            // Cargar imagen
            modalImage.src = image.url;
            modalImage.alt = image.description;

            // Cuando la imagen cargue
            modalImage.onload = function () {
                loader.style.display = 'none';
                modalImage.style.display = 'block';

                // Actualizar informaci√≥n
                document.getElementById('modal-author').textContent = image.author;
                document.getElementById('modal-date').textContent = `Publicado: ${image.date}`;
                document.getElementById('modal-likes').textContent = image.likes;
                document.getElementById('modal-description').textContent = image.description;

                // Actualizar tags
                const tagsContainer = document.getElementById('modal-tags');
                tagsContainer.innerHTML = image.tags.map(tag =>
                    `<span class="tag">${tag}</span>`
                ).join('');
            };
        }

        // Cerrar modal
        function closeModal() {
            const modal = document.getElementById('image-modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            selectedImage = null;
        }

        // Dar like a imagen
        function toggleLike(imageId) {
            const image = galleryImages.find(img => img.id === imageId);
            if (!image) return;

            image.likes++;

            // Actualizar UI
            const likeElement = document.querySelector(`[data-id="${imageId}"] .image-likes span`);
            if (likeElement) {
                likeElement.textContent = image.likes;
            }

            // Enviar like al servidor
            fetch('/api/galeria/like', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ imagen_id: imageId })
            });

            // Mostrar feedback
            showNotification('¬°Like registrado!', 'success');
        }

        // Compartir imagen
        function shareImage(imageId) {
            const image = galleryImages.find(img => img.id === imageId);
            if (!image) return;

            if (navigator.share) {
                navigator.share({
                    title: 'Foto de Trajineras Barr√≥n',
                    text: image.description,
                    url: image.url
                });
            } else {
                // Copiar al portapapeles
                navigator.clipboard.writeText(image.url);
                showNotification('Enlace copiado al portapapeles', 'info');
            }
        }

        // Cargar videos
        function loadVideos(videos) {
            const videosGrid = document.getElementById('videos-grid');

            if (!videos || videos.length === 0) {
                videosGrid.innerHTML = `
                    <div class="no-videos">
                        <i class="fas fa-video-slash"></i>
                        <p>No hay videos disponibles</p>
                    </div>
                `;
                return;
            }

            let html = '';

            videos.forEach(video => {
                html += `
                    <div class="video-card">
                        <div class="video-thumbnail">
                            <img src="${video.thumbnail}?w=400&h=225&fit=crop" alt="${video.titulo}">
                            <div class="video-play">
                                <i class="fas fa-play-circle"></i>
                            </div>
                            <div class="video-duration">${video.duracion}</div>
                        </div>
                        <div class="video-info">
                            <h4>${video.titulo}</h4>
                            <p class="video-desc">${video.descripcion}</p>
                            <div class="video-meta">
                                <span class="meta-item">
                                    <i class="far fa-eye"></i> ${video.vistas} vistas
                                </span>
                                <span class="meta-item">
                                    <i class="far fa-calendar"></i> ${video.fecha}
                                </span>
                            </div>
                            <button class="btn btn-outline btn-small watch-btn" onclick="playVideo('${video.id}')">
                                <i class="fas fa-play"></i> Ver Video
                            </button>
                        </div>
                    </div>
                `;
            });

            videosGrid.innerHTML = html;
        }

        // Reproducir video
        function playVideo(videoId) {
            // En una implementaci√≥n real, esto abrir√≠a un reproductor de video
            alert(`Reproduciendo video: ${videoId}`);
        }

        // Inicializar carrusel de experiencias
        function initExperiencesCarousel() {
            const swiper = new Swiper('.experiences-swiper', {
                slidesPerView: 1,
                spaceBetween: 20,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                breakpoints: {
                    640: { slidesPerView: 2 },
                    1024: { slidesPerView: 3 },
                    1400: { slidesPerView: 4 }
                }
            });
        }

        // Cargar experiencias
        function loadExperiences(experiencias) {
            const carousel = document.getElementById('experiences-carousel');

            if (!experiencias || experiencias.length === 0) return;

            let html = '';

            experiencias.forEach(exp => {
                html += `
                    <div class="swiper-slide">
                        <div class="experience-card" data-id="${exp.id}">
                            <div class="experience-image">
                                <img src="${exp.imagen}?w-400&h=300&fit=crop" alt="${exp.titulo}">
                                <div class="experience-count">
                                    <i class="fas fa-images"></i> ${exp.fotos} fotos
                                </div>
                            </div>
                            <div class="experience-content">
                                <h4>${exp.titulo}</h4>
                                <p class="experience-desc">${exp.descripcion}</p>
                                <button class="btn btn-outline btn-small" onclick="showExperienceDetails('${exp.id}')">
                                    <i class="fas fa-info-circle"></i> Ver m√°s
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            carousel.innerHTML = html;

            // Reinicializar Swiper
            setTimeout(() => {
                initExperiencesCarousel();
            }, 100);
        }

        // Mostrar detalles de experiencia
        function showExperienceDetails(expId) {
            // En una implementaci√≥n real, esto cargar√≠a m√°s detalles
            const detailsContainer = document.getElementById('experience-details');
            detailsContainer.innerHTML = `
                <div class="details-content">
                    <h4><i class="fas fa-info-circle"></i> Detalles de la experiencia</h4>
                    <p>Cargando informaci√≥n detallada...</p>
                </div>
            `;

            detailsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // Cargar √°lbumes
        function loadAlbums(albumes) {
            const albumsGrid = document.getElementById('albums-grid');

            if (!albumes || albumes.length === 0) return;

            let html = '';

            albumes.forEach(album => {
                html += `
                    <div class="album-card">
                        <div class="album-cover">
                            <img src="${album.portada}?w=400&h=300&fit=crop" alt="${album.nombre}">
                            <div class="album-overlay">
                                <div class="album-count">
                                    <i class="fas fa-images"></i>
                                    <span>${album.fotos} fotos</span>
                                </div>
                            </div>
                        </div>
                        <div class="album-info">
                            <h4>${album.nombre}</h4>
                            <p class="album-desc">${album.descripcion}</p>
                            <a href="/servicios?paquete=${album.paquete}" class="btn-link">
                                <i class="fas fa-external-link-alt"></i> Ver paquete
                            </a>
                        </div>
                    </div>
                `;
            });

            albumsGrid.innerHTML = html;
        }

        // Cargar hist√≥rico
        function loadHistorical(historico) {
            const timeline = document.getElementById('timeline-items');
            const beforeAfter = document.getElementById('before-after-gallery');

            if (!historico || historico.length === 0) return;

            // Timeline
            let timelineHtml = '';
            historico.forEach((item, index) => {
                timelineHtml += `
                    <div class="timeline-item" style="left: ${(index / (historico.length - 1)) * 100}%;">
                        <div class="timeline-dot"></div>
                        <div class="timeline-label">${item.epoca}</div>
                    </div>
                `;
            });
            timeline.innerHTML = timelineHtml;

            // Before/After
            let beforeAfterHtml = '<h3>Comparaci√≥n Antes/Despu√©s</h3>';
            historico.forEach(item => {
                beforeAfterHtml += `
                    <div class="before-after-item">
                        <div class="comparison-header">
                            <h4>${item.titulo}</h4>
                            <p>${item.descripcion}</p>
                        </div>
                        <div class="comparison-images">
                            <div class="image-container old">
                                <img src="${item.imagen_antigua}?w=400&h=300&fit=crop" alt="Antes">
                                <div class="image-label">Antes (${item.epoca})</div>
                            </div>
                            <div class="comparison-divider">
                                <i class="fas fa-arrows-alt-h"></i>
                            </div>
                            <div class="image-container new">
                                <img src="${item.imagen_actual}?w=400&h=300&fit=crop" alt="Ahora">
                                <div class="image-label">Ahora</div>
                            </div>
                        </div>
                        <div class="comparison-note">
                            <i class="fas fa-info-circle"></i> ${item.nota}
                        </div>
                    </div>
                `;
            });

            beforeAfter.innerHTML = beforeAfterHtml;
        }

        // Subir foto
        document.getElementById('photo-upload').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;

            if (!file.type.match('image.*')) {
                showNotification('Por favor, selecciona solo im√°genes', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB
                showNotification('La imagen es muy grande. M√°ximo 5MB.', 'error');
                return;
            }

            uploadedPhoto = file;

            // Mostrar vista previa
            const reader = new FileReader();
            reader.onload = function (e) {
                const preview = document.getElementById('upload-preview');
                preview.innerHTML = `
                    <img src="${e.target.result}" alt="Vista previa">
                    <button class="remove-preview" onclick="removePreview()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);

            // Mostrar formulario
            document.getElementById('upload-area').style.display = 'none';
            document.getElementById('upload-form').style.display = 'block';
        });

        // Eliminar vista previa
        function removePreview() {
            uploadedPhoto = null;
            document.getElementById('upload-preview').style.display = 'none';
            document.getElementById('upload-preview').innerHTML = '';
            document.getElementById('photo-upload').value = '';
        }

        // Cancelar subida
        function cancelUpload() {
            uploadedPhoto = null;
            document.getElementById('upload-area').style.display = 'block';
            document.getElementById('upload-form').style.display = 'none';
            document.getElementById('upload-preview').style.display = 'none';
            document.getElementById('upload-preview').innerHTML = '';
            document.getElementById('photo-upload').value = '';
            document.getElementById('photo-form').reset();
        }

        // Enviar foto
        async function submitPhoto() {
            if (!uploadedPhoto) {
                showNotification('Por favor, selecciona una foto', 'error');
                return;
            }

            const title = document.getElementById('photo-title').value;
            const description = document.getElementById('photo-description').value;
            const category = document.getElementById('photo-category').value;
            const hashtag = document.getElementById('photo-hashtag').value;
            const terms = document.getElementById('photo-terms').checked;

            if (!terms) {
                showNotification('Debes aceptar los t√©rminos de publicaci√≥n', 'error');
                return;
            }

            if (!description.trim()) {
                showNotification('Por favor, a√±ade una descripci√≥n', 'error');
                return;
            }

            // Simular env√≠o
            try {
                const response = await fetch('/api/galeria/subir', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        titulo: title,
                        descripcion: description,
                        categoria: category,
                        hashtag: hashtag
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('¬°Foto enviada exitosamente! Ser√° revisada pronto.', 'success');
                    cancelUpload();
                } else {
                    showNotification('Error al enviar la foto: ' + data.error, 'error');
                }

            } catch (error) {
                showNotification('Error de conexi√≥n. Intenta nuevamente.', 'error');
            }
        }

        // Copiar hashtag
        function copyHashtag() {
            navigator.clipboard.writeText('#XochimilcoBarron');
            showNotification('Hashtag copiado al portapapeles', 'success');
        }

        // Solicitud para fot√≥grafos
        async function submitPhotographerRequest() {
            const email = document.getElementById('photographer-email').value;

            if (!email || !email.includes('@')) {
                showNotification('Por favor, ingresa un email v√°lido', 'error');
                return;
            }

            try {
                const response = await fetch('/api/galeria/fotografos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Solicitud enviada. Te contactaremos pronto.', 'success');
                    document.getElementById('photographer-email').value = '';
                }

            } catch (error) {
                showNotification('Error al enviar solicitud', 'error');
            }
        }

        // Inicializar event listeners
        function initEventListeners() {
            // Cerrar modal con ESC
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });

            // Cerrar modal haciendo clic fuera
            document.getElementById('image-modal').addEventListener('click', function (e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Cambiar vista (grid/masonry)
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const view = this.dataset.view;

                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    currentView = view;
                    const grid = document.getElementById('gallery-grid');
                    grid.className = view === 'grid' ? 'gallery-grid' : 'gallery-grid masonry';
                });
            });
        }

        // Funciones auxiliares
        function showNotification(message, type = 'info') {
            // Crear notificaci√≥n
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            // Mostrar
            setTimeout(() => notification.classList.add('show'), 10);

            // Ocultar despu√©s de 3 segundos
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>

</html>